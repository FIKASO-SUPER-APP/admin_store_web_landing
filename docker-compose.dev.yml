# Configuration Docker Compose pour Développement Local
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

version: '3.8'

services:
  mysql:
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: fikaso_admin
    volumes:
      - ./mysql-init:/docker-entrypoint-initdb.d

  redis:
    ports:
      - "6379:6379"
    command: redis-server --requirepass dev_password

  admin:
    build:
      context: ./Admin Panel
      dockerfile: Dockerfile
    ports:
      - "8001:80"
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
      APP_KEY: base64:LOCAL_DEV_KEY_ADMIN
      DB_HOST: mysql
      DB_DATABASE: fikaso_admin
      DB_USERNAME: root
      DB_PASSWORD: root
      REDIS_PASSWORD: dev_password
      RUN_MIGRATIONS: "false"
    volumes:
      # Mount source code for hot reload
      - ./Admin Panel:/var/www/admin
    labels:
      - "traefik.enable=false"

  store:
    build:
      context: ./Store Panel
      dockerfile: Dockerfile
    ports:
      - "8002:80"
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
      APP_KEY: base64:LOCAL_DEV_KEY_STORE
      DB_HOST: mysql
      DB_DATABASE: fikaso_store
      DB_USERNAME: root
      DB_PASSWORD: root
      REDIS_PASSWORD: dev_password
      RUN_MIGRATIONS: "false"
    volumes:
      - ./Store Panel:/var/www/store
    labels:
      - "traefik.enable=false"

  website:
    build:
      context: ./Website Panel
      dockerfile: Dockerfile
    ports:
      - "8003:80"
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
      APP_KEY: base64:LOCAL_DEV_KEY_WEBSITE
      DB_HOST: mysql
      DB_DATABASE: fikaso_website
      DB_USERNAME: root
      DB_PASSWORD: root
      REDIS_PASSWORD: dev_password
      RUN_MIGRATIONS: "false"
    volumes:
      - ./Website Panel:/var/www/website
    labels:
      - "traefik.enable=false"

  landing:
    build:
      context: ./Landing Panel
      dockerfile: Dockerfile
    ports:
      - "8004:80"
    labels:
      - "traefik.enable=false"

  # phpMyAdmin pour gérer MySQL facilement
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: fikaso_phpmyadmin
    restart: unless-stopped
    ports:
      - "8080:80"
    environment:
      PMA_HOST: mysql
      PMA_USER: root
      PMA_PASSWORD: root
      UPLOAD_LIMIT: 100M
    depends_on:
      - mysql
    networks:
      - fikaso_network

  # Redis Commander pour gérer Redis facilement
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: fikaso_redis_commander
    restart: unless-stopped
    ports:
      - "8081:8081"
    environment:
      REDIS_HOSTS: local:redis:6379:0:dev_password
    depends_on:
      - redis
    networks:
      - fikaso_network

  # Mailhog pour tester les emails en local
  mailhog:
    image: mailhog/mailhog
    container_name: fikaso_mailhog
    restart: unless-stopped
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Interface Web
    networks:
      - fikaso_network

# Pas de Traefik en dev, accès direct aux ports

